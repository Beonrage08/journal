<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Professional Trading Journal & Portfolio</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    /* Reset and base */
    *, *::before, *::after {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: 'Inter', Arial, sans-serif;
      background: #f8fafc;
      color: #1e293b;
      line-height: 1.6;
      scroll-behavior: smooth;
    }
    a {
      color: #2563eb;
      text-decoration: none;
      cursor: pointer;
    }
    a:hover, a:focus {
      text-decoration: underline;
    }
    :focus {
      outline: 2px solid #3b82f6;
      outline-offset: 2px;
    }

    /* Header */
    header {
      position: fixed;
      top: 0;
      width: 100%;
      background: #0f172a;
      color: #e0e7ff;
      z-index: 1001;
      box-shadow: 0 2px 8px rgb(0 0 0 / 0.15);
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem 1.5rem;
    }
    .logo {
      font-weight: 700;
      font-size: 1.5rem;
      letter-spacing: 1.1px;
      user-select: none;
    }
    nav {
      display: flex;
      gap: 1rem;
    }
    nav button {
      background: transparent;
      border: none;
      color: #e0e7ff;
      font-weight: 600;
      font-size: 1rem;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      transition: background-color 0.3s ease;
      cursor: pointer;
      white-space: nowrap;
    }
    nav button:hover, nav button:focus {
      background: #2563eb;
      outline: none;
    }

    main {
      max-width: 960px;
      margin: 6rem auto 3rem;
      padding: 0 1rem;
    }

    section {
      background: #ffffff;
      padding: 2rem 2.5rem;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgb(0 0 0 / 0.08);
      margin-bottom: 2.5rem;
    }
    section h2 {
      margin-top: 0;
      font-weight: 700;
      margin-bottom: 1rem;
      border-bottom: 3px solid #2563eb;
      display: inline-block;
      padding-bottom: 0.4rem;
      color: #1e293b;
    }

    /* About */
    #about p {
      font-size: 1.1rem;
      color: #334155;
      max-width: 700px;
    }

    /* Form styling */
    form {
      display: grid;
      grid-template-columns: repeat(auto-fill,minmax(180px,1fr));
      gap: 1.2rem;
    }
    label {
      font-weight: 600;
      margin-bottom: 0.3rem;
      display: inline-block;
      color: #334155;
    }
    input, select, textarea {
      font-family: inherit;
      font-size: 1rem;
      padding: 0.65rem 0.9rem;
      border-radius: 8px;
      border: 1.8px solid #cbd5e1;
      background: #f9fafb;
      transition: border-color 0.3s ease;
      resize: vertical;
      min-height: 2.6rem;
    }
    textarea {
      grid-column: span 2;
      min-height: 4.5rem;
    }
    input[type="file"] {
      padding: 0.25rem 0.5rem;
      background: #fff;
      border-radius: 8px;
      border: 1.8px solid #cbd5e1;
      cursor: pointer;
    }
    input:focus, select:focus, textarea:focus, input[type="file"]:focus {
      border-color: #2563eb;
      outline: none;
      background: #fff;
      box-shadow: 0 0 8px #c7d5fe;
    }

    button[type="submit"] {
      grid-column: span 2;
      background-color: #2563eb;
      color: white;
      font-weight: 700;
      font-size: 1.1rem;
      border: none;
      padding: 0.8rem 1.25rem;
      border-radius: 10px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      align-self: start;
    }
    button[type="submit"]:hover, button[type="submit"]:focus {
      background-color: #1e40af;
      outline: none;
    }

    /* Table styling */
    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0 10px;
      font-size: 0.95rem;
      color: #334155;
    }
    thead th {
      color: #475569;
      font-weight: 700;
      background: transparent;
      padding: 0.6rem 0.5rem;
      text-align: left;
      border-bottom: 3px solid #2563eb;
    }
    tbody tr {
      background: #f1f5f9;
      box-shadow: 0 2px 8px rgb(0 0 0 / 0.06);
      border-radius: 8px;
      transition: background-color 0.25s ease;
    }
    tbody tr:hover {
      background-color: #e0e7ff;
    }
    tbody td {
      padding: 0.8rem 0.75rem;
      vertical-align: middle;
      border: none;
      min-width: 60px;
      word-wrap: break-word;
      max-width: 180px;
      overflow-wrap: break-word;
    }
    tbody td:nth-child(1) { min-width: 80px; }
    tbody td:nth-child(8), tbody td:nth-child(9) {
      text-align: center;
      width: 70px;
    }
    tbody button.delete-btn {
      color: #dc2626;
      font-weight: 600;
      border: 2px solid #dc2626;
      background: transparent;
      padding: 0.25rem 0.55rem;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    tbody button.delete-btn:hover, tbody button.delete-btn:focus {
      background-color: #dc2626;
      color: white;
      outline: none;
    }
    /* Thumbnail images in table */
    .thumb-img {
      max-width: 60px;
      max-height: 60px;
      border-radius: 6px;
      cursor: pointer;
      object-fit: cover;
      box-shadow: 0 2px 9px rgb(0 0 0 / 0.15);
      transition: transform 0.3s ease;
    }
    .thumb-img:hover, .thumb-img:focus {
      transform: scale(1.1);
      outline: none;
    }

    /* Modal for image preview */
    #imgModal {
      display: none;
      position: fixed;
      z-index: 1050;
      left: 0; top: 0;
      width: 100vw; height: 100vh;
      background: rgba(15,23,42,0.85);
      align-items: center;
      justify-content: center;
    }
    #imgModal.active {
      display: flex;
    }
    #imgModal img {
      max-width: 90vw;
      max-height: 90vh;
      border-radius: 12px;
      box-shadow: 0 6px 25px rgb(0 0 0 / 0.75);
    }
    #imgModal .close-btn {
      position: fixed;
      top: 1.2rem;
      right: 1.5rem;
      background: #2563eb;
      border: none;
      color: white;
      border-radius: 50%;
      width: 38px;
      height: 38px;
      font-size: 1.5rem;
      cursor: pointer;
      box-shadow: 0 2px 10px rgba(0,0,0,0.5);
      transition: background-color 0.3s ease;
      user-select: none;
    }
    #imgModal .close-btn:hover, #imgModal .close-btn:focus {
      background: #1e40af;
      outline: none;
    }

    /* Responsive improvements */
    @media (max-width: 650px) {
      nav {
        flex-wrap: wrap;
        gap: 0.5rem;
      }
      nav button {
        flex: 1 1 120px;
        font-size: 0.9rem;
        padding: 0.5rem 0.7rem;
      }
      form {
        grid-template-columns: 1fr !important;
      }
      textarea {
        grid-column: span 1 !important;
        min-height: 6rem;
      }
      table, thead, tbody, th, td, tr {
        display: block;
      }
      thead tr {
        position: absolute;
        top: -9999px;
        left: -9999px;
      }
      tbody tr {
        margin-bottom: 1rem;
        background: #fff;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        border-radius: 10px;
        padding: 1rem;
      }
      tbody td {
        border: none;
        position: relative;
        padding-left: 48%;
        text-align: left;
        color: #1e293b;
        font-weight: 600;
      }
      tbody td::before {
        position: absolute;
        top: 0.6rem;
        left: 1.1rem;
        width: 40%;
        padding-right: 1rem;
        white-space: nowrap;
        font-weight: 700;
        color: #2563eb;
      }
      tbody td:nth-of-type(1)::before { content: "Date"; }
      tbody td:nth-of-type(2)::before { content: "Asset"; }
      tbody td:nth-of-type(3)::before { content: "Type"; }
      tbody td:nth-of-type(4)::before { content: "Quantity"; }
      tbody td:nth-of-type(5)::before { content: "Price"; }
      tbody td:nth-of-type(6)::before { content: "Category"; }
      tbody td:nth-of-type(7)::before { content: "Notes"; }
      tbody td:nth-of-type(8)::before { content: "Attachment"; }
      tbody td:nth-of-type(9)::before { content: "Action"; }
      tbody button.delete-btn {
        width: 100%;
      }
      .thumb-img {
        max-width: 50px;
        max-height: 50px;
      }
    }
  </style>
</head>
<body>

<header>
  <div class="logo" tabindex="0" aria-label="My Trading Journal Logo">Trading Journal</div>
  <nav role="navigation" aria-label="Primary">
    <button onclick="scrollToSection('about')">About</button>
    <button onclick="scrollToSection('add-trade')">Add Trade</button>
    <button onclick="scrollToSection('journal')">Journal</button>
    <button onclick="openLink('https://github.com/yourusername')" aria-label="GitHub Profile">GitHub</button>
    <button onclick="openLink('https://linkedin.com/in/yourusername')" aria-label="LinkedIn Profile">LinkedIn</button>
  </nav>
</header>

<main>
  <section id="about" tabindex="-1">
    <h2>About Me</h2>
    <p>Welcome! I am a trader and this is my professional trading journal. Here, I track all my trades meticulously to analyze and improve my strategy over time.</p>
  </section>

  <section id="add-trade" tabindex="-1">
    <h2>Add a Trade</h2>
    <form id="tradeForm" aria-label="Add new trade" enctype="multipart/form-data">
      <div>
        <label for="date">Date *</label>
        <input type="date" id="date" required />
      </div>
      <div>
        <label for="asset">Asset *</label>
        <input type="text" id="asset" placeholder="Bitcoin, AAPL, EUR/USD" required />
      </div>
      <div>
        <label for="type">Buy/Sell *</label>
        <select id="type" required>
          <option value="">Select...</option>
          <option value="Buy">Buy</option>
          <option value="Sell">Sell</option>
        </select>
      </div>
      <div>
        <label for="quantity">Quantity *</label>
        <input type="number" id="quantity" placeholder="Amount" min="0" step="any" required />
      </div>
      <div>
        <label for="price">Price *</label>
        <input type="number" id="price" placeholder="Entry price" min="0" step="any" required />
      </div>
      <div>
        <label for="category">Category *</label>
        <input type="text" id="category" placeholder="Category, e.g. Forex, Crypto" required />
      </div>
      <div style="grid-column: span 2;">
        <label for="notes">Notes</label>
        <textarea id="notes" placeholder="Optional notes"></textarea>
      </div>
      <div style="grid-column: span 2;">
        <label for="attachment">Attachment (image)</label>
        <input type="file" id="attachment" accept="image/*" aria-describedby="attachmentHelp" />
        <small id="attachmentHelp" style="color:#64748b;">Optional image to attach with trade</small>
      </div>
      <div style="grid-column: span 2;">
        <button type="submit" aria-label="Add trade to journal">Add Trade</button>
      </div>
    </form>
  </section>

  <section id="journal" tabindex="-1">
    <h2>My Trades Journal</h2>
    <table aria-live="polite" aria-relevant="all" aria-label="Trading journal table">
      <thead>
        <tr>
          <th scope="col">Date</th>
          <th scope="col">Asset</th>
          <th scope="col">Type</th>
          <th scope="col">Quantity</th>
          <th scope="col">Price</th>
          <th scope="col">Category</th>
          <th scope="col">Notes</th>
          <th scope="col">Attachment</th>
          <th scope="col">Action</th>
        </tr>
      </thead>
      <tbody id="tradesTableBody">
        <!-- Trade entries injected by JavaScript -->
      </tbody>
    </table>
  </section>
</main>

<!-- Image modal -->
<div id="imgModal" role="dialog" aria-modal="true" aria-label="Image preview">
  <button class="close-btn" aria-label="Close image preview" onclick="closeModal()">Ã—</button>
  <img id="modalImage" src="" alt="Trade attachment preview" />
</div>

<script>
  // Utility: Scroll to section smoothly
  function scrollToSection(id) {
    const elem = document.getElementById(id);
    if (elem) {
      elem.focus();
      elem.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
  }
  // Utility: Open external link in new tab
  function openLink(url) {
    window.open(url, '_blank', 'noopener,noreferrer');
  }

  // Image modal logic
  const imgModal = document.getElementById('imgModal');
  const modalImage = document.getElementById('modalImage');

  function openModal(src, alt) {
    modalImage.src = src;
    modalImage.alt = alt || 'Trade attachment preview';
    imgModal.classList.add('active');
    imgModal.focus();
  }
  function closeModal() {
    modalImage.src = '';
    imgModal.classList.remove('active');
  }
  imgModal.addEventListener('click', (e) => {
    if (e.target === imgModal || e.target.classList.contains('close-btn')) {
      closeModal();
    }
  });
  window.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && imgModal.classList.contains('active')) {
      closeModal();
    }
  });

  // Trade Journal Logic
  const tradeForm = document.getElementById('tradeForm');
  const tradesTableBody = document.getElementById('tradesTableBody');

  function escapeHtml(text) {
    if (!text) return '';
    return text.replace(/&/g, "&amp;")
               .replace(/</g, "&lt;")
               .replace(/>/g, "&gt;")
               .replace(/"/g, "&quot;")
               .replace(/'/g, "&#039;");
  }

  function loadTrades() {
    const trades = JSON.parse(localStorage.getItem('trades')) || [];
    tradesTableBody.innerHTML = '';
    trades.forEach((trade, index) => {
      const row = document.createElement('tr');
      
      // If attachment exists, create a thumbnail img element with click
      let attachmentCellContent = '';
      if (trade.attachment) {
        attachmentCellContent = `<img tabindex="0" role="button" aria-label="Open attachment image" class="thumb-img" src="${trade.attachment}" alt="Attachment for trade dated ${trade.date}"/>`;
      } else {
        attachmentCellContent = '&mdash;';
      }

      row.innerHTML = `
        <td>${trade.date}</td>
        <td>${escapeHtml(trade.asset)}</td>
        <td>${trade.type}</td>
        <td>${trade.quantity}</td>
        <td>${trade.price}</td>
        <td>${escapeHtml(trade.category)}</td>
        <td>${escapeHtml(trade.notes)}</td>
        <td>${attachmentCellContent}</td>
        <td><button class="delete-btn" aria-label="Delete trade on ${trade.date} ${trade.asset}" data-index="${index}">Delete</button></td>
      `;
      tradesTableBody.appendChild(row);
    });

    // Attach event listeners for delete buttons and thumbnails
    Array.from(tradesTableBody.querySelectorAll('.delete-btn')).forEach(btn => {
      btn.addEventListener('click', (e) => {
        const idx = e.currentTarget.getAttribute('data-index');
        deleteTrade(Number(idx));
      });
    });
    Array.from(tradesTableBody.querySelectorAll('.thumb-img')).forEach(imgEl => {
      imgEl.addEventListener('click', () => openModal(imgEl.src, imgEl.alt));
      imgEl.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          openModal(imgEl.src, imgEl.alt);
        }
      });
    });
  }

  function deleteTrade(index) {
    const trades = JSON.parse(localStorage.getItem('trades')) || [];
    trades.splice(index, 1);
    localStorage.setItem('trades', JSON.stringify(trades));
    loadTrades();
  }

  tradeForm.addEventListener('submit', (e) => {
    e.preventDefault();
    const newTrade = {
      date: tradeForm.date.value,
      asset: tradeForm.asset.value.trim(),
      type: tradeForm.type.value,
      quantity: tradeForm.quantity.value,
      price: tradeForm.price.value,
      category: tradeForm.category.value.trim(),
      notes: tradeForm.notes.value.trim(),
      attachment: null,
    };

    if (!newTrade.date || !newTrade.asset || !newTrade.type || !newTrade.quantity || !newTrade.price || !newTrade.category) {
      alert('Please fill in all required fields.');
      return;
    }

    const fileInput = document.getElementById('attachment');
    const file = fileInput.files[0];

    if (file) {
      if (!file.type.startsWith('image/')) {
        alert('Please select a valid image file for attachment.');
        return;
      }

      const reader = new FileReader();
      reader.onload = function(evt) {
        newTrade.attachment = evt.target.result;
        saveTrade(newTrade);
      };
      reader.readAsDataURL(file);
    } else {
      saveTrade(newTrade);
    }
  });

  function saveTrade(newTrade) {
    const trades = JSON.parse(localStorage.getItem('trades')) || [];
    trades.push(newTrade);
    localStorage.setItem('trades', JSON.stringify(trades));
    tradeForm.reset();
    loadTrades();
    scrollToSection('journal');
    // Clear file input programmatically
    const fileInput = document.getElementById('attachment');
    fileInput.value = '';
  }

  window.addEventListener('load', loadTrades);
</script>

</body>
</html>
